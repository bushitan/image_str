<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/vmaig.css">
    <link rel="stylesheet" href="/static/css/vmaig_comments.css">
    <link rel="stylesheet" href="/static/css/vmaig_auth.css">
    <link rel="stylesheet" href="/static/jquery/jquery.Jcrop.min.css">

    <script src="/static/jquery/jquery-2.1.3.min.js"></script>
    <script src="/static/jquery/jquery.cookie.js"></script>
    <script src="/static/jquery/jquery.form.js"></script>
    <script src="/static/jquery/jquery.Jcrop.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
</head>
<body>
    <div>
        <img id="tmp-tx"  src="" alt="" width="auto" height="auto">
         <img id="img_resize"  src="" alt="" width="auto" height="auto">
    </div>

    <div>
         <form role="form" id="upload-tx-form">
                <div class="form-group">
                    <input type="button" id="save-tx" class="btn btn-vmaig-auth" value="确认转换">
                    <button type="button" class="btn btn-info">选择图片</button>
                    <input type="file" id="upload-tx" name="upload-tx">
                </div>
            </form>
    </div>
</body>


<script language="javascript" type="text/javascript">
    var image = new Image();
    var up_img,up_data,up_type;
    $("#upload-tx").change(function(){

        if(typeof FileReader == "undefined"){
            alert("您的浏览器不支持FileReader对象！");
        }

        var file = this.files[0];


        var reader = new FileReader();
        reader.readAsDataURL(file);


        reader.onload=function(e){
            image.src = e.target.result;
            $("#tmp-tx").attr("src",image.src);

            up_img = e.target.result;
            up_data =up_img .split(',')[1];
            up_type =up_img .split(',')[0].split('/')[1].split(';')[0];
            console.log(up_type)
        }
    });

$("#save-tx").click(function(){

    $.ajax({
        url:"/emoticon/resize/",
        type:"POST",
        data:{
//            "tx":canvas.toDataURL().split(',')[1],
            "img":up_data,
            "type":up_type,
        },
        beforeSend:function(xhr){
            xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken'));
        },
        success:function(data,textStatus){
//            console.log(data)
             $("#img_resize").attr("src",data);
//            window.location.href = "/art/pixel_tool/"+data.filename ;
        },
        error:function(XMLHttpRequest, textStatus, errorThrown){
            alert(XMLHttpRequest.responseText);
        }

    });

});

</script>
</html>